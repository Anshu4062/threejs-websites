import{exec as t}from"node:child_process";import{promisify as e}from"node:util";import{spinner as i}from"@clack/prompts";var o={CWD:process.cwd(),VSCODE_VERSION:null,MILLION_VERSION:null},n=e(t),l=(t,e)=>{let i;return new Promise((o=>{t.then((t=>{i&&clearTimeout(i),o(t)})),i=setTimeout((()=>{throw new Error}),e)}))},s=i();if(s.start("Installing VSCode extension"),await(async()=>{try{const t=await l(n("code -v"),3e3);return o.VSCODE_VERSION=t?.stdout,Boolean(!t?.stderr&&t?.stdout)}catch{return!1}})()){const t=await(async()=>{try{const t=await l(n("code --list-extensions --show-versions"),3e3);if(t?.stderr)return!1;const e=t?.stdout.split("\n");if(e)for(const t of e)if(t.includes("million.million-lint"))return o.MILLION_VERSION=t,!0}catch{}return!1})();await(async()=>{const t=await l(n("code --install-extension million.million-lint --force"),2e4);return!t?.stderr&&Boolean(!t?.stdout.toLowerCase().includes("failed")&&t?.stdout)})()?t?s.stop("Updating VSCode extension"):s.stop("VSCode extension installed"):s.stop("Unable to install via CLI. Install via marketplace: https://marketplace.visualstudio.com/items?itemName=million.million-lint")}else s.stop("Unable to install via CLI. Install via marketplace: https://marketplace.visualstudio.com/items?itemName=million.million-lint");